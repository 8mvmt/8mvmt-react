{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _asyncToGenerator = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _slicedToArray = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\n\nvar _objectSpread = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useStarknetCall = void 0;\n\nvar react_1 = require(\"react\");\n\nvar block_1 = require(\"../providers/block\");\n\nfunction starknetCallReducer(state, action) {\n  if (action.type === 'set_call_response') {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      data: action.data,\n      error: undefined,\n      loading: false\n    });\n  } else if (action.type === 'set_call_error') {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      error: action.error,\n      loading: false\n    });\n  } else if (action.type === 'set_last_updated_at') {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      loading: false,\n      lastUpdatedAt: action.blockHash\n    });\n  }\n\n  return state;\n}\n\nfunction useStarknetCall(_ref) {\n  var contract = _ref.contract,\n      method = _ref.method,\n      args = _ref.args,\n      options = _ref.options;\n\n  var _ref2 = (0, react_1.useReducer)(starknetCallReducer, {\n    loading: true,\n    lastUpdatedAt: ''\n  }),\n      _ref3 = _slicedToArray(_ref2, 2),\n      state = _ref3[0],\n      dispatch = _ref3[1];\n\n  var _ref4 = (0, block_1.useStarknetBlock)(),\n      block = _ref4.data; // default to true\n\n\n  var watch = (options === null || options === void 0 ? void 0 : options.watch) !== undefined ? options.watch : true;\n  var callContract = (0, react_1.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(contract && method && args)) {\n              _context.next = 4;\n              break;\n            }\n\n            _context.next = 3;\n            return contract.call(method, args);\n\n          case 3:\n            return _context.abrupt(\"return\", _context.sent);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), [contract, method, JSON.stringify(args)]);\n  var refresh = (0, react_1.useCallback)(function () {\n    callContract().then(function (response) {\n      if (response) {\n        dispatch({\n          type: 'set_call_response',\n          data: response\n        });\n      }\n    }).catch(function (err) {\n      if (err.message) {\n        dispatch({\n          type: 'set_call_error',\n          error: err.message\n        });\n      } else {\n        dispatch({\n          type: 'set_call_error',\n          error: 'call failed'\n        });\n      }\n    });\n  }, [callContract]);\n  (0, react_1.useEffect)(function () {\n    if (block !== null && block !== void 0 && block.block_hash) {\n      if ((block === null || block === void 0 ? void 0 : block.block_hash) == state.lastUpdatedAt) return; // if not watching never refresh, but fetch at least once\n\n      if (!watch && state.lastUpdatedAt !== '') return;\n      refresh();\n      dispatch({\n        type: 'set_last_updated_at',\n        blockHash: block.block_hash\n      });\n    }\n  }, [block === null || block === void 0 ? void 0 : block.block_hash, state.lastUpdatedAt, refresh, watch]); // always refresh on contract, method, or args change\n\n  (0, react_1.useEffect)(function () {\n    refresh(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [contract === null || contract === void 0 ? void 0 : contract.address, method, JSON.stringify(args)]);\n  return {\n    data: state.data,\n    loading: state.loading,\n    error: state.error,\n    refresh: refresh\n  };\n}\n\nexports.useStarknetCall = useStarknetCall;","map":{"version":3,"mappings":"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","names":["starknetCallReducer","state","action","type","data","error","undefined","loading","lastUpdatedAt","blockHash","useStarknetCall","contract","method","args","options","dispatch","block","watch","callContract","call","JSON","stringify","refresh","then","response","catch","err","message","block_hash","address","exports"],"sources":["../../src/hooks/call.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}