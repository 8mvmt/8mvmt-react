{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _asyncToGenerator = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _slicedToArray = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\n\nvar _objectSpread = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useStarknetManager = void 0;\n\nvar react_1 = require(\"react\");\n\nvar starknet_1 = require(\"starknet\");\n\nvar errors_1 = require(\"../../errors\");\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'set_account':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          account: action.account\n        });\n      }\n\n    case 'set_provider':\n      {\n        var _action$provider;\n\n        return _objectSpread(_objectSpread({}, state), {}, {\n          library: (_action$provider = action.provider) !== null && _action$provider !== void 0 ? _action$provider : starknet_1.defaultProvider\n        });\n      }\n\n    case 'set_connector':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          connector: action.connector\n        });\n      }\n\n    case 'set_error':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          error: action.error\n        });\n      }\n\n    default:\n      {\n        return state;\n      }\n  }\n}\n\nfunction useStarknetManager(_ref) {\n  var userDefaultProvider = _ref.defaultProvider,\n      userConnectors = _ref.connectors,\n      autoConnect = _ref.autoConnect;\n  var connectors = userConnectors !== null && userConnectors !== void 0 ? userConnectors : [];\n\n  var _ref2 = (0, react_1.useReducer)(reducer, {\n    library: userDefaultProvider ? userDefaultProvider : starknet_1.defaultProvider,\n    connectors: connectors\n  }),\n      _ref3 = _slicedToArray(_ref2, 2),\n      state = _ref3[0],\n      dispatch = _ref3[1];\n\n  var account = state.account,\n      library = state.library,\n      error = state.error;\n  var connect = (0, react_1.useCallback)(function (connector) {\n    connector.connect().then(function (account) {\n      dispatch({\n        type: 'set_account',\n        account: account.address\n      });\n      dispatch({\n        type: 'set_provider',\n        provider: account\n      });\n      dispatch({\n        type: 'set_connector',\n        connector: connector\n      });\n    }, function (err) {\n      console.error(err);\n      dispatch({\n        type: 'set_error',\n        error: new errors_1.ConnectorNotFoundError()\n      });\n    });\n  }, []);\n  var disconnect = (0, react_1.useCallback)(function () {\n    if (!state.connector) return;\n    state.connector.disconnect().then(function () {\n      dispatch({\n        type: 'set_account',\n        account: undefined\n      });\n      dispatch({\n        type: 'set_provider',\n        provider: undefined\n      });\n      dispatch({\n        type: 'set_connector',\n        connector: undefined\n      });\n    }, function (err) {\n      console.error(err);\n      dispatch({\n        type: 'set_error',\n        error: new errors_1.ConnectorNotFoundError()\n      });\n    });\n  }, [state.connector]);\n  (0, react_1.useEffect)(function () {\n    function tryAutoConnect(_x) {\n      return _tryAutoConnect.apply(this, arguments);\n    }\n\n    function _tryAutoConnect() {\n      _tryAutoConnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(connectors) {\n        var i, connector, _account;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                i = 0;\n\n              case 1:\n                if (!(i < connectors.length)) {\n                  _context.next = 22;\n                  break;\n                }\n\n                _context.prev = 2;\n                connector = connectors[i];\n                _context.next = 6;\n                return connector.ready();\n\n              case 6:\n                if (_context.sent) {\n                  _context.next = 8;\n                  break;\n                }\n\n                return _context.abrupt(\"continue\", 19);\n\n              case 8:\n                _context.next = 10;\n                return connector.connect();\n\n              case 10:\n                _account = _context.sent;\n                dispatch({\n                  type: 'set_account',\n                  account: _account.address\n                });\n                dispatch({\n                  type: 'set_provider',\n                  provider: _account\n                });\n                dispatch({\n                  type: 'set_connector',\n                  connector: connector\n                }); // Success, stop trying.\n\n                return _context.abrupt(\"return\");\n\n              case 17:\n                _context.prev = 17;\n                _context.t0 = _context[\"catch\"](2);\n\n              case 19:\n                i++;\n                _context.next = 1;\n                break;\n\n              case 22:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 17]]);\n      }));\n      return _tryAutoConnect.apply(this, arguments);\n    }\n\n    if (autoConnect && !account) {\n      tryAutoConnect(connectors);\n    } // Dependencies intentionally omitted since we only want\n    // this executed once.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  return {\n    account: account,\n    connect: connect,\n    disconnect: disconnect,\n    connectors: connectors,\n    library: library,\n    error: error\n  };\n}\n\nexports.useStarknetManager = useStarknetManager;","map":{"version":3,"mappings":"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","names":["reducer","state","action","type","account","library","provider","starknet_1","connector","error","useStarknetManager","userDefaultProvider","defaultProvider","userConnectors","connectors","autoConnect","dispatch","connect","then","address","err","console","errors_1","disconnect","undefined","tryAutoConnect","i","length","ready","exports"],"sources":["../../../src/providers/starknet/manager.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}