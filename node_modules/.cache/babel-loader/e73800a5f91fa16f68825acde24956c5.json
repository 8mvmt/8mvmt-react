{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _createForOfIteratorHelper = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\n\nvar _asyncToGenerator = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _slicedToArray = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\n\nvar _objectSpread = require(\"/Users/rmzlb/Dropbox/Mac (2)/Documents/GitHub/8mvmt-react/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useSignTypedData = void 0;\n\nvar react_1 = require(\"react\");\n\nvar starknet_1 = require(\"../providers/starknet\");\n\nfunction starknetSignReducer(state, action) {\n  if (action.type === 'start_signing') {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      loading: true\n    });\n  } else if (action.type === 'set_signature') {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      data: action.data,\n      loading: false\n    });\n  } else if (action.type === 'set_error') {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      error: action.error,\n      loading: false\n    });\n  } else if (action.type === 'reset') {\n    return _objectSpread(_objectSpread({}, state), {}, {\n      data: undefined,\n      error: undefined,\n      loading: false\n    });\n  }\n\n  return state;\n}\n\nfunction useSignTypedData(typedData) {\n  var _ref = (0, react_1.useReducer)(starknetSignReducer, {\n    loading: false\n  }),\n      _ref2 = _slicedToArray(_ref, 2),\n      state = _ref2[0],\n      dispatch = _ref2[1];\n\n  var _ref3 = (0, starknet_1.useStarknet)(),\n      accountAddress = _ref3.account,\n      connectors = _ref3.connectors;\n\n  var reset = (0, react_1.useCallback)(function () {\n    dispatch({\n      type: 'reset'\n    });\n  }, [dispatch]);\n  var data = state.data,\n      error = state.error,\n      loading = state.loading;\n  var signTypedData = (0, react_1.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var accountInterface, _iterator, _step, connector, account, response, errorMessage;\n\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            dispatch({\n              type: 'reset'\n            });\n            dispatch({\n              type: 'start_signing'\n            });\n            _context.prev = 2;\n            accountInterface = null;\n            _iterator = _createForOfIteratorHelper(connectors);\n            _context.prev = 5;\n\n            _iterator.s();\n\n          case 7:\n            if ((_step = _iterator.n()).done) {\n              _context.next = 17;\n              break;\n            }\n\n            connector = _step.value;\n            _context.next = 11;\n            return connector.account();\n\n          case 11:\n            account = _context.sent;\n\n            if (!(account.address === accountAddress)) {\n              _context.next = 15;\n              break;\n            }\n\n            accountInterface = account;\n            return _context.abrupt(\"break\", 17);\n\n          case 15:\n            _context.next = 7;\n            break;\n\n          case 17:\n            _context.next = 22;\n            break;\n\n          case 19:\n            _context.prev = 19;\n            _context.t0 = _context[\"catch\"](5);\n\n            _iterator.e(_context.t0);\n\n          case 22:\n            _context.prev = 22;\n\n            _iterator.f();\n\n            return _context.finish(22);\n\n          case 25:\n            if (accountInterface) {\n              _context.next = 27;\n              break;\n            }\n\n            throw new Error(\"No connector for address \".concat(accountAddress));\n\n          case 27:\n            _context.next = 29;\n            return accountInterface.signMessage(typedData);\n\n          case 29:\n            response = _context.sent;\n            dispatch({\n              type: 'set_signature',\n              data: response\n            });\n            return _context.abrupt(\"return\", response);\n\n          case 34:\n            _context.prev = 34;\n            _context.t1 = _context[\"catch\"](2);\n            errorMessage = _context.t1 instanceof Error ? _context.t1.message : String(_context.t1);\n            dispatch({\n              type: 'set_error',\n              error: errorMessage\n            });\n            console.error(_context.t1);\n\n          case 39:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[2, 34], [5, 19, 22, 25]]);\n  })), [accountAddress, connectors, typedData]);\n  return {\n    data: data,\n    error: error,\n    loading: loading,\n    signTypedData: signTypedData,\n    reset: reset\n  };\n}\n\nexports.useSignTypedData = useSignTypedData;","map":{"version":3,"mappings":"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","names":["starknetSignReducer","state","action","type","loading","data","error","undefined","useSignTypedData","typedData","dispatch","accountAddress","account","connectors","reset","signTypedData","accountInterface","connector","address","Error","signMessage","response","errorMessage","message","String","console","exports"],"sources":["../../src/hooks/sign.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}